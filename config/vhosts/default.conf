# Apache VirtualHost Configuration for Docker LAMP Stack
# This configuration works in both direct access and reverse proxy modes

<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot ${APACHE_DOCUMENT_ROOT}
    ServerName localhost
    
    <Directory ${APACHE_DOCUMENT_ROOT}>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Handle X-Forwarded-* headers when behind reverse proxy
    SetEnvIf X-Forwarded-Proto https HTTPS=on
    SetEnvIf X-Forwarded-Proto https REQUEST_SCHEME=https
    SetEnvIf X-Forwarded-Host ^(.+)$ HTTP_HOST=$1

    # Error and access logs
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>

# HTTPS VirtualHost (for direct access mode)
# Uncomment this section if you want to access Apache directly via HTTPS
# (without nginx reverse proxy)
# You'll need to generate SSL certificates first: ./generate-ssl-certs.sh
#
# <VirtualHost *:443>
#     ServerAdmin webmaster@localhost
#     DocumentRoot ${APACHE_DOCUMENT_ROOT}
#     ServerName localhost
#     
#     <Directory ${APACHE_DOCUMENT_ROOT}>
#         Options Indexes FollowSymLinks
#         AllowOverride All
#         Require all granted
#     </Directory>
# 
#     # SSL Configuration
#     SSLEngine on
#     SSLCertificateFile /etc/apache2/ssl/cert.pem
#     SSLCertificateKeyFile /etc/apache2/ssl/cert-key.pem
#     
#     # Modern SSL configuration
#     SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
#     SSLCipherSuite HIGH:!aNULL:!MD5
#     SSLHonorCipherOrder on
#     
#     # Error and access logs
#     ErrorLog ${APACHE_LOG_DIR}/ssl_error.log
#     CustomLog ${APACHE_LOG_DIR}/ssl_access.log combined
# </VirtualHost>
